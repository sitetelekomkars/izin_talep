<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ä°zin Talep PortalÄ± (Site Telekom)</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        :root { --primary: #2563eb; --bg: #f1f5f9; --ik-color: #7c3aed; --header-text: #1e293b; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .container { max-width: 1100px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        
        /* Header ve Logo AlanÄ± */
        .header-area {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 15px;
        }
        .logo-img {
            height: 60px; 
            width: auto;
            object-fit: contain;
        }
        .header-title {
            color: var(--header-text);
            margin: 0;
            font-size: 1.8em;
        }

        /* Navigasyon */
        .nav-buttons { display: flex; gap: 10px; margin-bottom: 20px; padding-bottom: 10px; }
        .nav-btn { flex: 1; padding: 15px; border: none; background: #e2e8f0; color: #64748b; border-radius: 10px; cursor: pointer; font-weight: bold; transition: 0.3s; font-size: 1em; display: flex; align-items: center; justify-content: center; gap: 8px;}
        .nav-btn:hover { opacity: 0.9; transform: translateY(-2px); }
        .nav-btn.active[data-role="personel"] { background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3); }
        .nav-btn.active[data-role="yonetici"] { background: #f59e0b; color: white; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3); }
        .nav-btn.active[data-role="ik"] { background: var(--ik-color); color: white; box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3); }

        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: 600; margin-bottom: 5px; color: #334155; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; box-sizing: border-box; font-size: 1em; transition: 0.3s; }
        input:focus, select:focus, textarea:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        
        button.submit-btn { width: 100%; padding: 14px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1.1em; transition: 0.3s; }
        button.submit-btn:hover { background: #1d4ed8; }
        button.submit-btn:disabled { background: #94a3b8; cursor: not-allowed; }
        
        /* Admin Tablo Stilleri */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #e2e8f0; font-size: 0.95em; vertical-align: top; }
        th { background: #f8fafc; color: #64748b; text-transform: uppercase; font-size: 0.85em; letter-spacing: 0.5px; }
        tr:hover { background-color: #f8fafc; }

        /* Durum Etiketleri */
        .status { padding: 5px 10px; border-radius: 20px; font-size: 0.75em; font-weight: 800; display: inline-block; margin-bottom: 4px; letter-spacing: 0.5px; }
        .st-tl_bekliyor { background: #fff7ed; color: #c2410c; border: 1px solid #ffedd5; }
        .st-ik_bekliyor { background: #f5f3ff; color: #6d28d9; border: 1px solid #ede9fe; }
        .st-onaylandi { background: #f0fdf4; color: #15803d; border: 1px solid #dcfce7; }
        .st-red { background: #fef2f2; color: #b91c1c; border: 1px solid #fee2e2; }

        .day-badge { background: #e0f2fe; color: #0369a1; padding: 2px 8px; border-radius: 4px; font-size: 0.85em; font-weight: bold; margin-left: 5px; }
        .project-badge { background: #334155; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.75em; margin-left: 5px; }

        .action-btn { padding: 6px 12px; margin-right: 5px; border: none; border-radius: 6px; color: white; cursor: pointer; font-size: 0.9em; transition: 0.2s; }
        .action-btn:hover { transform: scale(1.05); }
        .approve { background: #22c55e; } 
        .reject { background: #ef4444; }
        
        .hidden { display: none; }
        .loading { text-align: center; color: var(--primary); font-weight: bold; margin: 20px 0; }

        /* =========================================
           YENÄ° KART TASARIMI (GeÃ§miÅŸ Ä°zinler Ä°Ã§in)
           ========================================= */
        .history-list { display: flex; flex-direction: column; gap: 15px; }
        
        .history-card {
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            border-left: 6px solid #ccc;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
            transition: all 0.3s ease;
            position: relative;
        }
        .history-card:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.08); }

        /* Kart Renkleri */
        .history-card.st-onaylandi { border-left-color: #22c55e; background: linear-gradient(to right, #f0fdf4, #fff); }
        .history-card.st-red { border-left-color: #ef4444; background: linear-gradient(to right, #fef2f2, #fff); }
        .history-card.st-tl_bekliyor { border-left-color: #f59e0b; }
        .history-card.st-ik_bekliyor { border-left-color: #7c3aed; }

        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .card-date { font-weight: 700; color: #1e293b; font-size: 1.1em; display: flex; align-items: center; gap: 8px; }
        .card-days-pill { background: #e2e8f0; color: #475569; font-size: 0.75em; padding: 4px 10px; border-radius: 20px; }

        .card-body { font-size: 1em; color: #475569; margin-bottom: 15px; line-height: 1.5; }
        .card-type { color: #0f172a; font-weight: 600; }

        .card-footer { 
            display: flex; justify-content: space-between; align-items: center; 
            border-top: 1px solid #f1f5f9; padding-top: 12px; margin-top: 5px; font-size: 0.9em; 
        }

        .approver-badge { 
            display: flex; align-items: center; gap: 6px; 
            background: #fff; border: 1px solid #cbd5e1; 
            padding: 5px 12px; border-radius: 30px; 
            color: #334155; font-weight: 600; font-size: 0.85em;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        
        /* BakÄ±m Modu */
        #maintenance-screen {
            display: none; text-align: center; padding: 50px;
            background: white; max-width: 600px; margin: 50px auto;
            border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>

<div id="maintenance-screen">
    <h1 style="font-size: 3em; margin-bottom: 10px;">ğŸš§</h1>
    <h2 style="color: #1e293b;">Sistem BakÄ±mda</h2>
    <p style="color: #64748b; font-size: 1.1em;">Åu an gÃ¼ncelleme Ã§alÄ±ÅŸmasÄ± yapÄ±lmaktadÄ±r.<br>LÃ¼tfen daha sonra tekrar deneyiniz.</p>
</div>

<div class="container" id="main-app">
    
    <div class="header-area">
        <img src="https://cdn-icons-png.flaticon.com/512/2942/2942544.png" alt="Site Telekom Logo" class="logo-img" id="companyLogo" id="companyLogo">
        <h2 class="header-title">Ä°zin YÃ¶netim Sistemi</h2>
    </div>
    
    <div class="nav-buttons">
        <button class="nav-btn active" data-role="personel" onclick="switchRole('personel')">ğŸ‘¤ Personel</button>
        <button class="nav-btn" data-role="yonetici" onclick="switchRole('yonetici')">ğŸ›¡ï¸ YÃ¶netici (TL)</button>
        <button class="nav-btn" data-role="ik" onclick="switchRole('ik')">ğŸ¢ Ä°K</button>
    </div>

    <div id="personel-panel">
        <div class="panel-info" style="background:#eff6ff; padding:15px; border-radius:8px; color:#1e40af; margin-bottom:20px; border-left: 5px solid #2563eb;">
            ğŸ‘‹ <strong>HoÅŸ Geldiniz!</strong> Yeni izin talebi oluÅŸturabilir veya geÃ§miÅŸ izinlerinizi sorgulayabilirsiniz.
        </div>

        <form id="leaveForm" onsubmit="submitLeave(event)">
            <div class="form-group">
                <label>Ad Soyad</label>
                <input type="text" id="name" placeholder="AdÄ±nÄ±z ve SoyadÄ±nÄ±z" required>
            </div>
            
            <div class="form-group">
                <label>Proje</label>
                <select id="project" required>
                    <option value="" disabled selected>SeÃ§iniz...</option>
                    <option value="TTNET">TTNET</option>
                    <option value="TÃœRKNET">TÃœRKNET</option>
                    <option value="OSK">OSK</option>
                    <option value="SSPORT">SSPORT</option>
                    <option value="TÃœRKSAT">TÃœRKSAT</option>
                </select>
            </div>

            <div class="form-group" style="display:flex; gap:10px;">
                <div style="flex:1">
                    <label>BaÅŸlangÄ±Ã§</label>
                    <input type="date" id="startDate" onchange="calcDays()" required>
                </div>
                <div style="flex:1">
                    <label>BitiÅŸ</label>
                    <input type="date" id="endDate" onchange="calcDays()" required>
                </div>
            </div>
            <div class="form-group">
                <label>Toplam: <span id="dayPreview" style="font-weight:normal">-</span></label>
            </div>
            <div class="form-group">
                <label>Ä°zin TÃ¼rÃ¼</label>
                <select id="type">
                    <option value="YÄ±llÄ±k Ä°zin">YÄ±llÄ±k Ä°zin</option>
                    <option value="HastalÄ±k">HastalÄ±k Raporu</option>
                    <option value="Mazeret">Mazeret Ä°zni</option>
                    <option value="BabalÄ±k">BabalÄ±k Ä°zni</option>
                    <option value="Cenaze izni">Cenaze izni</option>
                    <option value="DiÄŸer">DiÄŸer</option>
                </select>
            </div>
            <div class="form-group">
                <label>AÃ§Ä±klama</label>
                <textarea id="reason" rows="3" placeholder="Ä°zin nedeni..." required></textarea>
            </div>
            <button type="submit" class="submit-btn" id="btnSubmit">Talebi GÃ¶nder</button>
        </form>

        <div id="history-area" style="margin-top: 30px; border-top: 2px dashed #e2e8f0; padding-top: 20px;">
            <h4 style="display:flex; align-items:center; gap:10px;">ğŸ“‚ GeÃ§miÅŸ Ä°zinlerim</h4>
            <p style="font-size:0.9em; color:#64748b;">AdÄ±nÄ±zÄ± yazÄ±p butona basarak eski taleplerinizin durumunu gÃ¶rebilirsiniz.</p>
            <button type="button" style="background:#475569; color:white; border:none; padding:12px 25px; border-radius:8px; cursor:pointer; font-weight:bold; font-size:1em;" onclick="loadRequests('personel')">ğŸ” GeÃ§miÅŸimi Getir</button>
            
            <div id="personelHistoryList" class="history-list hidden" style="margin-top:25px;"></div>
        </div>
    </div>

    <div id="admin-panel" class="hidden">
        <div id="admin-header" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <div id="admin-msg" style="padding:10px; border-radius:6px; background:#fffbeb; color:#92400e; flex:1;"></div>
            <div style="margin-left:10px; font-size:0.9em; color:#64748b;">GiriÅŸ: <strong id="activeAdminName" style="color:#0f172a;"></strong></div>
        </div>
        
        <div id="loader" class="loading hidden">
            <div style="display:inline-block; width:20px; height:20px; border:3px solid #f3f3f3; border-top:3px solid var(--primary); border-radius:50%; animation: spin 1s linear infinite;"></div>
            Veriler YÃ¼kleniyor...
        </div>
        
        <table id="requestsTable">
            <thead>
                <tr>
                    <th style="width:25%">Personel / Proje</th>
                    <th style="width:25%">Tarih / GÃ¼n</th>
                    <th style="width:30%">TÃ¼r / AÃ§Ä±klama</th>
                    <th style="width:20%">Durum / Ä°ÅŸlem</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
</div>

<style>
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
</style>

<script>
    // ==========================================
    // ğŸš§ BAKIM MODU AYARI (AÃ§mak iÃ§in false yap)
    // ==========================================
    const BAKIM_MODU = false; 
    // ==========================================

    if (BAKIM_MODU) {
        document.getElementById('main-app').style.display = 'none';
        document.getElementById('maintenance-screen').style.display = 'block';
        document.body.style.background = "#e2e8f0";
    }

    const API_URL = "https://script.google.com/macros/s/AKfycby1QGB4lpO_VRt-PYCORj9DggoYvvwGPcSxGq4gTD9deYPpyNQr1bjMwncaKW6hGxgeSw/exec";
    
    const YONETICI_SIFRE = "36487"; 
    const IK_SIFRE = "snn128936";       

    let currentRole = 'personel';
    let currentAdminName = '';

    async function switchRole(role) {
        currentAdminName = '';
        document.getElementById('activeAdminName').innerText = '';

        if (role === 'personel') {
            activateTab(role);
            return;
        }

        let targetPassword = (role === 'yonetici') ? YONETICI_SIFRE : IK_SIFRE;
        let roleTitle = (role === 'yonetici') ? 'YÃ¶netici (TL) GiriÅŸi' : 'Ä°K GiriÅŸi';
        let roleColor = (role === 'yonetici') ? '#f59e0b' : '#7c3aed';

        const { value: password } = await Swal.fire({
            title: roleTitle,
            text: 'LÃ¼tfen giriÅŸ ÅŸifresini giriniz',
            input: 'password',
            inputPlaceholder: 'Åifre',
            inputAttributes: { autocapitalize: 'off', autocorrect: 'off' },
            confirmButtonText: 'GiriÅŸ Yap',
            confirmButtonColor: roleColor,
            showCancelButton: true,
            cancelButtonText: 'Ä°ptal',
            backdrop: `rgba(0,0,0,0.4)`
        });

        if (!password) return;

        if (password !== targetPassword) {
            Swal.fire({ icon: 'error', title: 'HatalÄ± Åifre!', text: 'GirdiÄŸiniz ÅŸifre yanlÄ±ÅŸ.', confirmButtonColor: '#ef4444' });
            return;
        }

        const { value: adminName } = await Swal.fire({
            title: 'HoÅŸ Geldiniz',
            text: 'Ä°ÅŸlem kaydÄ± iÃ§in lÃ¼tfen AdÄ±nÄ±zÄ± SoyadÄ±nÄ±zÄ± giriniz:',
            input: 'text',
            inputPlaceholder: 'Ad Soyad',
            confirmButtonText: 'Panele Git',
            confirmButtonColor: roleColor,
            allowOutsideClick: false,
            inputValidator: (value) => { if (!value) { return 'Ä°sim alanÄ± boÅŸ bÄ±rakÄ±lamaz!' } }
        });

        if (adminName) {
            currentAdminName = adminName;
            document.getElementById('activeAdminName').innerText = currentAdminName;
            activateTab(role);
        }
    }

    function activateTab(role) {
        currentRole = role;
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.querySelector(`[data-role="${role}"]`).classList.add('active');
        document.getElementById('personel-panel').classList.toggle('hidden', role !== 'personel');
        document.getElementById('admin-panel').classList.toggle('hidden', role === 'personel');

        if(role !== 'personel') {
            const msg = document.getElementById('admin-msg');
            if(role === 'yonetici') {
                msg.innerHTML = "ğŸ›¡ï¸ <strong>YÃ¶netici Paneli:</strong> OnayladÄ±ÄŸÄ±nÄ±z talepler Ä°K'ya iletilir.";
                msg.style.background = "#fff7ed"; msg.style.color = "#c2410c";
            } else {
                msg.innerHTML = "ğŸ¢ <strong>Ä°K Paneli:</strong> YÃ¶neticiden gelen talepleri sonuÃ§landÄ±rabilirsiniz.";
                msg.style.background = "#f5f3ff"; msg.style.color = "#6d28d9";
            }
            loadRequests('admin');
        }
    }

    function calcDays() {
        const s = document.getElementById('startDate').value;
        const e = document.getElementById('endDate').value;
        const p = document.getElementById('dayPreview');
        if(s && e) {
            const diff = new Date(e) - new Date(s);
            const days = Math.ceil(diff / (1000*60*60*24)) + 1;
            if(days > 0) {
                p.innerText = days + " GÃ¼n";
                p.style.color = "var(--primary)";
                p.style.fontWeight = "bold";
            } else {
                p.innerText = "HatalÄ± Tarih";
                p.style.color = "red";
            }
        }
    }

    function submitLeave(e) {
        e.preventDefault();
        const btn = document.getElementById('btnSubmit');
        const s = document.getElementById('startDate').value;
        const e_date = document.getElementById('endDate').value;
        const days = Math.ceil((new Date(e_date) - new Date(s)) / (1000*60*60*24)) + 1;

        if(days <= 0) { Swal.fire('Hata', 'BitiÅŸ tarihi baÅŸlangÄ±Ã§tan Ã¶nce olamaz.', 'error'); return; }

        btn.disabled = true; btn.innerText = "GÃ¶nderiliyor...";

        const data = {
            action: 'create',
            id: Date.now(),
            name: document.getElementById('name').value.trim(),
            project: document.getElementById('project').value,
            start: s, end: e_date, days: days,
            type: document.getElementById('type').value,
            reason: document.getElementById('reason').value,
            status: 'tl_bekliyor'
        };

        fetch(API_URL, { method: "POST", body: JSON.stringify(data) })
        .then(() => {
            Swal.fire({ icon: 'success', title: 'BaÅŸarÄ±lÄ±!', text: 'Ä°zin talebiniz yÃ¶netici onayÄ±na gÃ¶nderildi.', timer: 3000, showConfirmButton: false });
            document.getElementById('leaveForm').reset();
            document.getElementById('dayPreview').innerText = "-";
            btn.disabled = false; btn.innerText = "Talebi GÃ¶nder";
        }).catch(err => { Swal.fire('Hata', 'Sunucu hatasÄ±: ' + err, 'error'); btn.disabled = false; });
    }

    function loadRequests(mode) {
        let fetchUrl = API_URL;
        if (mode === 'personel') {
            const nameVal = document.getElementById('name').value.trim();
            if(!nameVal) { Swal.fire('UyarÄ±','LÃ¼tfen Ã¶nce yukarÄ±ya Ad Soyad giriniz.','warning'); return; }
            fetchUrl += "?name=" + encodeURIComponent(nameVal);
            
            const listContainer = document.getElementById('personelHistoryList');
            listContainer.classList.remove('hidden');
            listContainer.innerHTML = '<div style="text-align:center; padding:20px; font-size:1.2em;">â³ GeÃ§miÅŸ YÃ¼kleniyor...</div>';

            fetch(fetchUrl).then(res => res.json()).then(data => {
                listContainer.innerHTML = '';
                if(data.length === 0) { listContainer.innerHTML = '<div style="text-align:center; padding:10px; color:#94a3b8;">KayÄ±t bulunamadÄ±.</div>'; return; }
                
                data.reverse().forEach(req => {
                    let footerContent = "";
                    if(req.status === 'red') {
                        footerContent = `<span style="color:#ef4444; font-weight:bold;">ğŸ›‘ Red Sebebi: ${req.reject_reason || '-'}</span>`;
                    } else if (req.approver) {
                        footerContent = `<div class="approver-badge"><span style="color:#22c55e">âœ”</span> Onaylayan: ${req.approver}</div>`;
                    } else {
                        footerContent = `<span style="color:#f59e0b; font-style:italic;">â³ Ä°ÅŸlem Bekleniyor</span>`;
                    }

                    const cardHtml = `
                        <div class="history-card st-${req.status}">
                            <div class="card-header">
                                <div class="card-date">
                                    ğŸ“… ${formatDate(req.start)} - ${formatDate(req.end)}
                                    <span class="card-days-pill">${req.days} GÃ¼n</span>
                                </div>
                                <div class="status st-${req.status}">${getStatusName(req.status)}</div>
                            </div>
                            <div class="card-body">
                                <div class="card-type">${req.type}</div>
                                <div>${req.reason}</div>
                            </div>
                            <div class="card-footer">
                                ${footerContent}
                            </div>
                        </div>
                    `;
                    listContainer.innerHTML += cardHtml;
                });
            });
        } else {
            const loader = document.getElementById('loader');
            const tbody = document.getElementById('tableBody');
            loader.classList.remove('hidden');
            tbody.innerHTML = '';

            fetch(API_URL).then(res => res.json()).then(data => {
                loader.classList.add('hidden');
                if(data.length === 0) { tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding:20px;">HenÃ¼z talep yok.</td></tr>'; return; }
                data.reverse().forEach(req => renderAdminRow(req, tbody));
            });
        }
    }

    function renderAdminRow(req, tbody) {
        let actionHtml = '';
        if(currentRole === 'yonetici' && req.status === 'tl_bekliyor') {
            actionHtml = `<button class="action-btn approve" onclick="updateStatus(${req.id}, 'ik_bekliyor')" title="Onayla">âœ”</button>
                          <button class="action-btn reject" onclick="rejectRequest(${req.id})" title="Reddet">âœ–</button>`;
        } else if(currentRole === 'ik' && req.status === 'ik_bekliyor') {
            actionHtml = `<button class="action-btn approve" onclick="updateStatus(${req.id}, 'onaylandi')" title="Bitir">âœ”</button>
                          <button class="action-btn reject" onclick="rejectRequest(${req.id})" title="Reddet">âœ–</button>`;
        } else {
            actionHtml = `<span class="status st-${req.status}">${getStatusName(req.status)}</span>`;
        }

        let details = "";
        if(req.status === 'red' && req.reject_reason) { details += `<span class="reject-reason">Red Nedeni: ${req.reject_reason}</span>`; }
        if(req.approver) { details += `<div class="audit-info">ğŸ“ ${req.approver}</div>`; }

        const projectName = req.project ? req.project : "";

        const row = `
            <tr>
                <td><strong style="color:#1e293b;">${req.name}</strong><br>${projectName ? `<span class="project-badge">${projectName}</span>` : ''}</td>
                <td>${formatDate(req.start)} <span class="day-badge">${req.days} G</span></td>
                <td>${req.type}<br><small style="color:#64748b; font-style:italic;">"${req.reason}"</small></td>
                <td>${actionHtml}${details}</td>
            </tr>
        `;
        tbody.innerHTML += row;
    }

    async function rejectRequest(id) {
        const { value: reason } = await Swal.fire({
            title: 'Reddetme Sebebi', input: 'text', inputLabel: 'LÃ¼tfen red sebebini giriniz:',
            inputPlaceholder: 'Ã–rn: YoÄŸunluk nedeniyle...', showCancelButton: true,
            confirmButtonColor: '#ef4444', confirmButtonText: 'Reddet', cancelButtonText: 'Ä°ptal',
            inputValidator: (value) => { if (!value) { return 'Sebep yazmanÄ±z gerekmektedir!' } }
        });
        if (reason) { updateStatus(id, 'red', reason); }
    }

    function updateStatus(id, status, rejectReason = "") {
        if(status !== 'red') {
             Swal.fire({
                title: 'Emin misiniz?', text: "Bu iÅŸlemi onaylÄ±yor musunuz?", icon: 'question',
                showCancelButton: true, confirmButtonColor: '#22c55e', cancelButtonColor: '#d33',
                confirmButtonText: 'Evet, Onayla', cancelButtonText: 'VazgeÃ§'
            }).then((result) => { if (result.isConfirmed) { executeStatusUpdate(id, status, rejectReason); } });
        } else { executeStatusUpdate(id, status, rejectReason); }
    }

    function executeStatusUpdate(id, status, rejectReason) {
        document.getElementById('loader').classList.remove('hidden');
        const payload = { action: 'update', id: id, status: status, approver: currentAdminName, rejectReason: rejectReason };
        fetch(API_URL, { method: "POST", body: JSON.stringify(payload) }).then(() => {
            loadRequests('admin');
            const msg = status === 'red' ? 'Talep reddedildi.' : 'Ä°ÅŸlem baÅŸarÄ±yla tamamlandÄ±.';
            Swal.fire('TamamlandÄ±!', msg, 'success');
        });
    }

    function formatDate(dateString) {
        if (!dateString) return "";
        const date = new Date(dateString);
        if (isNaN(date.getTime())) { return dateString.split('-').reverse().join('.'); }
        return date.toLocaleDateString('tr-TR', { day: '2-digit', month: '2-digit', year: 'numeric' });
    }

    function getStatusName(s) {
        const map = { 'tl_bekliyor': 'TL OnayÄ±', 'ik_bekliyor': 'Ä°K OnayÄ±', 'onaylandi': 'TamamlandÄ±', 'red': 'Reddedildi' };
        return map[s] || s;
    }
</script>

</body>
</html>

